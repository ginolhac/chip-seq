<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>chip-seq tutorials</title>
  

  <link rel="shortcut icon" href="./img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="./css/theme.css" type="text/css" />
  <link rel="stylesheet" href="./css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="./css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "None";
  </script>
  
  <script src="./js/jquery-2.1.1.min.js"></script>
  <script src="./js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="./js/highlight.pack.js"></script>
  <script src="./js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> chip-seq tutorials</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href=".">Introduction</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#chip-seq-practical-session">ChIP-seq practical session</a></li>
                
                    <li><a class="toctree-l4" href="#log-in-gaia">log in gaia</a></li>
                
                    <li><a class="toctree-l4" href="#monitoring-the-resources-used">monitoring the resources used</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="cli/">command line, basics</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="install/">Setup</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="fastqc/">sequence QC</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="mapping/">Mapping</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="peak/">Peak calling</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="public/">Public data</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="contact/">Contact</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">chip-seq tutorials</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>Introduction</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="chip-seq-practical-session">ChIP-seq practical session</h1>
<p>Running all analyses is computationally intensive and despite the power of the current laptops, jobs should be run on high-performance clusters (HPC).</p>
<h2 id="log-in-gaia">log in <code>gaia</code></h2>
<p><a href="https://hpc.uni.lu/systems/gaia/"><code>gaia</code></a> is one of the <a href="https://hpc.uni.lu">HPC of the UNI</a>.</p>
<h3 id="connect-to-the-frontend">connect to the frontend</h3>
<p>To connect to it, you need an account and an authorized ssh key. Actually, a pair of keys, one public and one private.
The public key is sent over when connecting to the remote and compared to the authorized private key.
A match allows the sender to log in. No password required.</p>
<p>After the setting up of your account, the following should work if you are using mac or GNU/Linux:</p>
<pre><code>ssh gaia-cluster
</code></pre>

<p>Otherwise, on Windows, right-click on <code>pageant</code> in the system tray and load a saved session <code>gaia</code>. In the terminal, log as your username, such as <code>student01</code>.</p>
<p>You should see the following prompt of the gaia frontend:</p>
<pre><code>===============================================================================
 /!\ NEVER COMPILE OR RUN YOUR PROGRAMS FROM THIS FRONTEND !
     First reserve your nodes (using oarsub(1))
Linux access.gaia-cluster.uni.lux 3.2.0-4-amd64 unknown
 16:45:49 up 126 days,  1:28, 34 users,  load average: 0.96, 1.58, 1.73
0 16:45:49 your_login@access(gaia-cluster) ~ $
</code></pre>

<p>Note that you are on the <code>access</code> frontend.</p>
<p>The frontend is meant for browsing / transferring your files only and you <strong>MUST</strong> connect to a node for any computational work 
using the utility <code>oarsub</code> described <a href="https://hpc.uni.lu/users/docs/oar.html">here</a>. This program managed the queuing system and dispatch jobs among the resources according to the demands.</p>
<p>Software are organized into <strong>modules</strong> that provide you with the binaries but also all the environment required for their running processes.</p>
<h4 id="tmux">TMUX</h4>
<p>log in to a remote computer is great, all computation, heat generation is happening elsewhere but this comes with a price: disconnection.<br />
This happens all the time. The way to get around it, is to have a <code>screen</code> system that store your terminal, commands, environment in which 
you can easily detach and re-attach.</p>
<p>Two systems exist, <code>screen</code> and <code>tmux</code>. Both work well, but <code>tmux</code> has a nicer interface IMHO.</p>
<p>a short tutorial is <a href="https://www.sitepoint.com/tmux-a-simple-start/">accessible here.</a></p>
<p>Briefly, on the <strong>access</strong> frontend, start a <code>tmux</code> instance with</p>
<pre><code>tmux
</code></pre>

<p>to detach (press CTRL and B together, release then use the next key):</p>
<pre><code>CTRL + B, then D
</code></pre>

<p>to re-attach:</p>
<pre><code>tmux attach
</code></pre>

<p>or the alias</p>
<pre><code>tmux at
</code></pre>

<h4 id="some-useful-commands">some useful commands</h4>
<p>once in an instance,</p>
<ul>
<li><strong>create</strong> a new tab</li>
</ul>
<pre><code>CTRL + B, then C
</code></pre>

<ul>
<li>move to the <strong>next</strong> tab</li>
</ul>
<pre><code>CTRL + B, then N
</code></pre>

<ul>
<li>move to the <strong>previous</strong> tab</li>
</ul>
<pre><code>CTRL + B, then P
</code></pre>

<ul>
<li><strong>rename</strong> to the current tab</li>
</ul>
<pre><code>CTRL + B, then ,
</code></pre>

<p>then type the new name</p>
<h4 id="quit">Quit</h4>
<pre><code>exit
</code></pre>

<p>in all tabs kills the <code>tmux</code> session</p>
<p>Of note, <code>tmux</code> instances live until the frontend is rebooted.</p>
<h3 id="connect-to-a-node">connect to a node</h3>
<p>Connecting to a computing node is anyway required to use modules.</p>
<p>You need to book ressources by specifying how many cores, optionaly if they are a same node, and a walltime clock. A job can never get extended.</p>
<p>For Thursday:</p>
<pre><code>oarsub -I -t inner=3950979 -l nodes=1,walltime=9
oarsub -I -t inner=3950994 -l nodes=1,walltime=9
oarsub -I -t inner=3950995 -l nodes=1,walltime=9
</code></pre>

<p>For Friday:</p>
<pre><code>oarsub -I -t inner=3950983 -l nodes=1,walltime=9
oarsub -I -t inner=3950992 -l nodes=1,walltime=9
oarsub -I -t inner=3950993 -l nodes=1,walltime=9
</code></pre>

<p>Without entering into the details of <a href="https://hpc.uni.lu/users/docs/oar.html#request-hierarchical-resources-with-oarsub">submitting a job</a>,
here is the explanation for the above command:</p>
<ul>
<li><code>-I</code> is for interactive, default is passive</li>
<li><code>-t inner=xxx</code>, connect to a <code>container</code>, specific for today because we booked resources for the course</li>
<li><code>-l</code> define the resources you need. The less you ask for, the more high up you are in the queue. A <code>node</code> is usually composed of 12 or 24 <code>cores</code>, 
so 12 tasks could be run in parallel. <code>walltime</code> define for how long in hours your job will last.</li>
</ul>
<p>Once logged in, the prompt changes for:</p>
<pre><code>09:14:48 your_login@gaia-66(gaia-cluster)[OAR3511326-&gt;717]
</code></pre>

<p>where you see the node you are logged to (here <code>gaia-66</code>), the job ID (3511326) and the time in minutes before your job will be killed (717 minutes).</p>
<h2 id="monitoring-the-resources-used">monitoring the resources used</h2>
<p>On a shared cluster, you have to take of <strong>three</strong> things:</p>
<ol>
<li>memory usage</li>
<li>cores used</li>
<li>disk space</li>
</ol>
<h3 id="memory">memory</h3>
<p>Each node has
On an interactive session, use the command <code>htop</code> to see if the memory is not full. If the system is swapping (using hard drives for memory storage)
it becomes super slow and eventually stalled.</p>
<p>For passive sessions, you can use <a href="https://hpc.uni.lu/gaia/ganglia/">ganglia</a> to check out the nodes you are using.</p>
<h3 id="cores">cores</h3>
<p>even if you book 10 cores, nothing will prevent you from starting 100 jobs. They will run but then tasks are distributed on the available resources.
In this example, each task will use 1/10th of a core, then runs very slowly.<br />
On an interactive session, use the command <code>htop</code> to see if a process is correctly using close to 100% of a core.</p>
<h3 id="disk-space">disk space</h3>
<p>Like on your local machine, you need to check how much data you used.
Using a command line, you could use</p>
<h4 id="disk-usage">disk usage</h4>
<pre><code>du -sh ~
</code></pre>

<p>to display your disk usage (<code>du</code>) for your home folder (<code>~</code>). In a form readable by human (<code>-h</code>)</p>
<h4 id="disk-free">disk free</h4>
<pre><code>df -h
</code></pre>

<p>disk free scans all disks mounted. Could takes time to display the global usage. 
Please worry if only few Mb are available on the disk you are planning to write to.</p>
<h3 id="closing-connection">closing connection</h3>
<p>When you are done, you can kill yourself your job by either doing <code>CTRL + D</code> or typing <code>exit</code>.
That will free your booked ressources for others. Once done, you will still logged on the frontend and normally inside a <code>tmux</code>.
The best is to detach from the <code>tmux</code> instance and log off from the gaia frontend using  <code>CTRL + D</code> or typing <code>exit</code>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cli/" class="btn btn-neutral float-right" title="command line, basics"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
        <span style="margin-left: 15px"><a href="cli/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>

<!--
MkDocs version : 0.14.0
Build Date UTC : 2016-09-13 09:29:39.740204
-->
